from smb.SMBConnection import SMBConnection
from nmb.NetBIOS import NetBIOS
import os

# 远程服务器信息
server_ip = "remote_server_ip"
server_name = "remote_server_name"  # 远程服务器NetBIOS名称
username = "your_username"
password = "your_password"
share_name = "C$"  # 共享名称，例如C$代表C盘
folder_path = "path\\to\\folder"  # 远程文件夹路径，例如"Users\\Public\\Documents"

# 创建NetBIOS对象以解决服务器名称
bios = NetBIOS()
server_name_resolved = bios.queryIPForName(server_ip)
if not server_name_resolved:
    print("无法解析服务器名称")
    exit()

server_name = server_name_resolved[0]

# 连接到远程服务器
conn = SMBConnection(username, password, "my_machine_name", server_name, use_ntlm_v2=True)
assert conn.connect(server_ip, 139)

# 列出文件夹中的文件
files = conn.listPath(share_name, folder_path)
for file in files:
    print(file.filename)

# 关闭连接
conn.close()
